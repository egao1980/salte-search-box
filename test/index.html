<!doctype html>

<html>
  <head>
    <title>salte-search-box test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../salte-search-box.html">
  </head>
  <body>

    <test-fixture id="basic">
      <template>
        <salte-search-box></salte-search-box>
      </template>
    </test-fixture>

    <script>
      suite('salte-search-box', function() {
        var element;
        setup(function() {
          element = fixture('basic');
          element.set('results', [{
            key: 'polymer',
            value: 'Polymer University'
          }, {
            key: 'salte',
            value: 'Salte University'
          }])
        });

        test('instantiating the element works', function() {
          assert.equal(element.is, 'salte-search-box');
        });

        test('should display the list when focused with elements', function(done) {
          element.set('focused', true);
          assert.equal(element.$.repeater.items.length, element.results.length);
          assert.equal(element.$.list.style.height, '96px');
          flush(function() {
            assert.equal(Polymer.dom(element.root).querySelectorAll('paper-item').length, element.results.length);
            done();
          });
        });

        test('should fire off search-select when an item is selected', function(done) {
          element.set('valueKey', 'key');
          assert.equal(element.value, '');
          element.open();
          assert.equal(element.opened, true);
          flush(function() {
            element.addEventListener('search-select', function() {
              assert.equal(element.value, 'polymer');
              assert.equal(element.opened, false);
              done();
            });
            Polymer.dom(element.root).querySelector('paper-item').fire('mousedown');
          });
        });

        test('should support clearing the value', function(done) {
          element.set('value', 'test');
          flush(function() {
            Polymer.dom(element.root).querySelector('#clear').click();
            assert.equal(element.value, '');
            done();
          });
        });
      });
    </script>
  </body>
</html>
